sudo: required
services:
- docker
env:
  global:
  - IMAGE_NAME=forbsey/api.tutorialedge.net
  - REGISTRY_USER=forbsey
  - secure: v3PInjzHusfevRp+fAOwrpuDty9+CTvGjREN7svYKfJF/XhCYMkf/L99121QTJDx5aClWQ+g6Jc4GG5WnTBfzQC/9QfA/C/P3sB2gE5yVxo4/Z5DylFioY3o5SLULZqvXnzgjj38dxk675EVQ+j6S7tiyY6ktgP4lJj/m2SnleJpHrXJ+srpGZuzSOYS1p+pxLKb3nsifzf1DrP57JxCAfFfxL4BWiVGCTjlS4idVHEIPA5HsI3Mobjx0aLVQA+LCUGcPT1VvGyjheEGd1EDNIb/9qkNZKRunLaKsN/8eyFi523QXdHdhAgmmNufzG2L+hDnok3f1YUx0cxM61ylzE1zhW5rrMsgiZ+pv7OSmzTZu5dAIVsom2HnPRex7pPUh/nyrhhFZIKQCBKT6hZpBilYb5sWC89nmBLncKumszXLGCP47fVneA68TTOE/cOGwYkpBY94xx4gWv84MF6449by/qbwnHM536tYEvzufbVx0STUoMPq+5xRpBNrIo8/PUp/K2UeMNMV+KYXclj5tOr0VysoUczt1ZmoT+OBUdhs9oy3LxaIiYJZZGC74MWvet5tW/E9yzZAQ5+jnCz6a6XSh3uJeSSxizybU6HtJZIMdtFeUfXLixiz6amlfguOk9Pg/v9e9LECwrpfFpmZABJstLw2DQ02MdfjqAiYhMo=
script:
- version="0.0.15"
- docker build --pull --cache-from "$IMAGE_NAME" --tag "$IMAGE_NAME" .
after_script:
- docker images
before_deploy:
- docker login -u "$REGISTRY_USER" -p "$REGISTRY_PASS"
- docker tag "$IMAGE_NAME" "${IMAGE_NAME}:latest"
- docker tag "$IMAGE_NAME" "${IMAGE_NAME}:${version}"
deploy:
  provider: script
  script: docker push "${IMAGE_NAME}:latest" && docker push "${IMAGE_NAME}:${version}"
  on:
    branch: master
